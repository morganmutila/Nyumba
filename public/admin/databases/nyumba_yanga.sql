-- MySQL Script generated by MySQL Workbench
-- Wed May  8 14:18:34 2019
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION';

-- -----------------------------------------------------
-- Schema nyumba_yanga
-- -----------------------------------------------------
-- Database schema for the Nyumba Yanga web app
DROP SCHEMA IF EXISTS `nyumba_yanga` ;

-- -----------------------------------------------------
-- Schema nyumba_yanga
--
-- Database schema for the Nyumba Yanga web app
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `nyumba_yanga` DEFAULT CHARACTER SET utf8 ;
USE `nyumba_yanga` ;

-- -----------------------------------------------------
-- Table `nyumba_yanga`.`city`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `nyumba_yanga`.`city` ;

CREATE TABLE IF NOT EXISTS `nyumba_yanga`.`city` (
  `id` SMALLINT(5) UNSIGNED NOT NULL AUTO_INCREMENT,
  `city` VARCHAR(45) NOT NULL,
  `last_update` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  INDEX `city` (`city` ASC) ,
  UNIQUE INDEX `city_UNIQUE` (`city` ASC) )
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8;


-- -----------------------------------------------------
-- Table `nyumba_yanga`.`location`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `nyumba_yanga`.`location` ;

CREATE TABLE IF NOT EXISTS `nyumba_yanga`.`location` (
  `id` SMALLINT(5) UNSIGNED NOT NULL AUTO_INCREMENT,
  `city_id` SMALLINT(5) UNSIGNED NOT NULL,
  `location` VARCHAR(45) NOT NULL,
  `description` MEDIUMTEXT NOT NULL,
  `last_update` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  INDEX `fk_location_city1_idx` (`city_id` ASC) ,
  UNIQUE INDEX `location_UNIQUE` (`location` ASC) ,
  CONSTRAINT `fk_location_city1`
    FOREIGN KEY (`city_id`)
    REFERENCES `nyumba_yanga`.`city` (`id`)
    ON DELETE RESTRICT
    ON UPDATE CASCADE)
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8;


-- -----------------------------------------------------
-- Table `nyumba_yanga`.`users`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `nyumba_yanga`.`users` ;

CREATE TABLE IF NOT EXISTS `nyumba_yanga`.`users` (
  `id` INT(11) UNSIGNED NOT NULL AUTO_INCREMENT,
  `location_id` SMALLINT(5) UNSIGNED NOT NULL,
  `group_id` TINYINT(2) UNSIGNED NOT NULL DEFAULT 1,
  `first_name` VARCHAR(45) NOT NULL,
  `last_name` VARCHAR(45) NOT NULL,
  `username` VARCHAR(50) NOT NULL,
  `email` VARCHAR(50) NOT NULL,
  `phone` VARCHAR(15) NOT NULL,
  `password` VARCHAR(255) NOT NULL,
  `joined` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `status` VARCHAR(60) NOT NULL DEFAULT 'active',
  `last_login` DATETIME NOT NULL,
  `ip` VARCHAR(15) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE INDEX `phone` (`phone` ASC) ,
  UNIQUE INDEX `username` (`username` ASC) ,
  INDEX `name` USING BTREE (`first_name`, `last_name`) ,
  INDEX `login` (`username` ASC, `email` ASC, `phone` ASC, `password` ASC) ,
  INDEX `location_id_idx` (`location_id` ASC) ,
  CONSTRAINT `location_id`
    FOREIGN KEY (`location_id`)
    REFERENCES `nyumba_yanga`.`location` (`id`)
    ON DELETE RESTRICT
    ON UPDATE CASCADE)
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8;


-- -----------------------------------------------------
-- Table `nyumba_yanga`.`users_session`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `nyumba_yanga`.`users_session` ;

CREATE TABLE IF NOT EXISTS `nyumba_yanga`.`users_session` (
  `id` INT UNSIGNED NOT NULL AUTO_INCREMENT,
  `user_id` INT UNSIGNED NOT NULL,
  `hash` VARCHAR(255) NOT NULL,
  PRIMARY KEY (`id`),
  INDEX `user_id` (`user_id` ASC) ,
  CONSTRAINT `user_id`
    FOREIGN KEY (`user_id`)
    REFERENCES `nyumba_yanga`.`users` (`id`)
    ON DELETE RESTRICT
    ON UPDATE CASCADE)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `nyumba_yanga`.`group`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `nyumba_yanga`.`group` ;

CREATE TABLE IF NOT EXISTS `nyumba_yanga`.`group` (
  `id` TINYINT(2) UNSIGNED NOT NULL,
  `name` VARCHAR(45) NOT NULL,
  `permission` TINYTEXT NOT NULL,
  PRIMARY KEY (`id`),
  INDEX `name` (`name` ASC) )
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8;


-- -----------------------------------------------------
-- Table `nyumba_yanga`.`staff`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `nyumba_yanga`.`staff` ;

CREATE TABLE IF NOT EXISTS `nyumba_yanga`.`staff` (
  `id` SMALLINT(5) UNSIGNED NOT NULL AUTO_INCREMENT,
  `city_id` SMALLINT(5) UNSIGNED NULL,
  `group_id` TINYINT(2) UNSIGNED NOT NULL DEFAULT 2,
  `first_name` VARCHAR(45) NOT NULL,
  `last_name` VARCHAR(45) NOT NULL,
  `email` VARCHAR(50) NOT NULL,
  `phone` VARCHAR(15) NOT NULL,
  `job_title` VARCHAR(100) NOT NULL,
  `password` VARCHAR(255) NOT NULL,
  `city` VARCHAR(45) NOT NULL,
  `province` VARCHAR(45) NOT NULL,
  `avatar` VARCHAR(45) NOT NULL,
  `gender` ENUM('male, female') NULL,
  `joined` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `last_login` DATETIME NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE INDEX `email` (`email` ASC) ,
  UNIQUE INDEX `phone` (`phone` ASC) ,
  INDEX `name` USING BTREE (`first_name`, `last_name`) ,
  INDEX `login` USING BTREE (`email`, `password`) ,
  INDEX `staff_group1_idx` (`group_id` ASC) ,
  INDEX `staff_city1_idx` (`city_id` ASC) ,
  CONSTRAINT `fk_staff_group1`
    FOREIGN KEY (`group_id`)
    REFERENCES `nyumba_yanga`.`group` (`id`)
    ON DELETE RESTRICT
    ON UPDATE CASCADE,
  CONSTRAINT `fk_staff_city1`
    FOREIGN KEY (`city_id`)
    REFERENCES `nyumba_yanga`.`city` (`id`)
    ON DELETE RESTRICT
    ON UPDATE CASCADE)
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8;


-- -----------------------------------------------------
-- Table `nyumba_yanga`.`property`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `nyumba_yanga`.`property` ;

CREATE TABLE IF NOT EXISTS `nyumba_yanga`.`property` (
  `id` INT(11) UNSIGNED NOT NULL AUTO_INCREMENT,
  `user_id` INT(11) UNSIGNED NOT NULL,
  `location_id` SMALLINT(5) UNSIGNED NOT NULL,
  `address` VARCHAR(100) NOT NULL,
  `beds` TINYINT(2) UNSIGNED NOT NULL DEFAULT 0,
  `baths` FLOAT(2) UNSIGNED NOT NULL DEFAULT 0,
  `terms` VARCHAR(100) NOT NULL,
  `size` VARCHAR(45) NOT NULL,
  `units` TINYINT(4) UNSIGNED NOT NULL DEFAULT 1,
  `type` VARCHAR(200) NOT NULL,
  `price` DECIMAL(10,2) UNSIGNED NOT NULL DEFAULT 0.00,
  `description` TEXT NOT NULL,
  `cphoto` VARCHAR(50) NOT NULL,
  `added` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `owner` VARCHAR(50) NOT NULL,
  `contact_number` VARCHAR(15) NOT NULL,
  `contact_email` VARCHAR(50) NOT NULL,
  `available` DATE NOT NULL,
  `views` INT(11) UNSIGNED NOT NULL DEFAULT 0,
  `reference` VARCHAR(45) NOT NULL,
  `status` TINYINT(2) UNSIGNED NOT NULL DEFAULT 1,
  `listed_by` VARCHAR(60) NULL,
  `market` VARCHAR(60) NOT NULL DEFAULT 'rent',
  `flags` TINYINT(4) NOT NULL DEFAULT 0,
  PRIMARY KEY (`id`),
  INDEX `fk_user_id` (`user_id` ASC) ,
  INDEX `location_id` (`location_id` ASC) ,
  INDEX `added_on` (`added` ASC) ,
  INDEX `property_price` USING BTREE (`price`, `market`) ,
  INDEX `market_type` USING BTREE (`market`) ,
  CONSTRAINT `fk_user_id`
    FOREIGN KEY (`user_id`)
    REFERENCES `nyumba_yanga`.`users` (`id`)
    ON DELETE RESTRICT
    ON UPDATE CASCADE,
  CONSTRAINT `fk_property_location1`
    FOREIGN KEY (`location_id`)
    REFERENCES `nyumba_yanga`.`location` (`id`)
    ON DELETE RESTRICT
    ON UPDATE CASCADE)
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8;


-- -----------------------------------------------------
-- Table `nyumba_yanga`.`property_feature`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `nyumba_yanga`.`property_feature` ;

CREATE TABLE IF NOT EXISTS `nyumba_yanga`.`property_feature` (
  `id` INT(11) UNSIGNED NOT NULL AUTO_INCREMENT,
  `feature` VARCHAR(125) NOT NULL,
  `type` ENUM('indoor', 'outdoor') NOT NULL,
  `last_update` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  INDEX `feature_name` (`feature` ASC) ,
  UNIQUE INDEX `feature_UNIQUE` (`feature` ASC) )
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8;


-- -----------------------------------------------------
-- Table `nyumba_yanga`.`amenities`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `nyumba_yanga`.`amenities` ;

CREATE TABLE IF NOT EXISTS `nyumba_yanga`.`amenities` (
  `property_id` INT(11) UNSIGNED NOT NULL,
  `feature_id` INT(11) UNSIGNED NOT NULL,
  PRIMARY KEY (`feature_id`, `property_id`),
  INDEX `property_id_idx` (`property_id` ASC) ,
  INDEX `feature_id_idx` (`feature_id` ASC) ,
  CONSTRAINT `fk_feature_id`
    FOREIGN KEY (`feature_id`)
    REFERENCES `nyumba_yanga`.`property_feature` (`id`)
    ON DELETE CASCADE
    ON UPDATE CASCADE,
  CONSTRAINT `fk_property_id`
    FOREIGN KEY (`property_id`)
    REFERENCES `nyumba_yanga`.`property` (`id`)
    ON DELETE CASCADE
    ON UPDATE CASCADE)
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8;


-- -----------------------------------------------------
-- Table `nyumba_yanga`.`property_photo`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `nyumba_yanga`.`property_photo` ;

CREATE TABLE IF NOT EXISTS `nyumba_yanga`.`property_photo` (
  `id` BIGINT(11) UNSIGNED NOT NULL,
  `property_id` INT(11) UNSIGNED NOT NULL,
  `photo` VARCHAR(125) NULL,
  `last_update` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  INDEX `property_photo` (`property_id` ASC) ,
  CONSTRAINT `property_photo`
    FOREIGN KEY (`property_id`)
    REFERENCES `nyumba_yanga`.`property` (`id`)
    ON DELETE RESTRICT
    ON UPDATE CASCADE)
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8;


-- -----------------------------------------------------
-- Table `nyumba_yanga`.`saved_property`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `nyumba_yanga`.`saved_property` ;

CREATE TABLE IF NOT EXISTS `nyumba_yanga`.`saved_property` (
  `id` SMALLINT(5) UNSIGNED NOT NULL AUTO_INCREMENT,
  `user_id` INT(11) UNSIGNED NOT NULL,
  `property_id` INT(11) UNSIGNED NOT NULL,
  `created` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  INDEX `user_property_id` USING BTREE (`property_id`, `user_id`) ,
  INDEX `user_id_idx` (`user_id` ASC) ,
  UNIQUE INDEX `property_id_UNIQUE` (`property_id` ASC) ,
  CONSTRAINT `fk_user_id_3`
    FOREIGN KEY (`user_id`)
    REFERENCES `nyumba_yanga`.`users` (`id`)
    ON DELETE CASCADE
    ON UPDATE CASCADE,
  CONSTRAINT `fk_property_id_3`
    FOREIGN KEY (`property_id`)
    REFERENCES `nyumba_yanga`.`property` (`id`)
    ON DELETE CASCADE
    ON UPDATE CASCADE)
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8;


-- -----------------------------------------------------
-- Table `nyumba_yanga`.`reported_property`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `nyumba_yanga`.`reported_property` ;

CREATE TABLE IF NOT EXISTS `nyumba_yanga`.`reported_property` (
  `id` INT(11) UNSIGNED NOT NULL,
  `reason` VARCHAR(100) NOT NULL,
  `description` TEXT NULL,
  `reported` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `property_id` INT(11) UNSIGNED NOT NULL,
  PRIMARY KEY (`id`),
  INDEX `fk_reported_property_property1_idx` (`property_id` ASC) ,
  CONSTRAINT `fk_reported_property_property1`
    FOREIGN KEY (`property_id`)
    REFERENCES `nyumba_yanga`.`property` (`id`)
    ON DELETE CASCADE
    ON UPDATE CASCADE)
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8;


-- -----------------------------------------------------
-- Table `nyumba_yanga`.`saved_search`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `nyumba_yanga`.`saved_search` ;

CREATE TABLE IF NOT EXISTS `nyumba_yanga`.`saved_search` (
  `id` SMALLINT(5) UNSIGNED NOT NULL,
  `user_id` INT(11) UNSIGNED NOT NULL,
  `search_url` TINYTEXT NOT NULL,
  `created` TIMESTAMP NOT NULL,
  `users_id` INT(11) UNSIGNED NOT NULL,
  PRIMARY KEY (`id`),
  INDEX `fk_saved_search_users1_idx` (`users_id` ASC) ,
  CONSTRAINT `fk_saved_search_users1`
    FOREIGN KEY (`users_id`)
    REFERENCES `nyumba_yanga`.`users` (`id`)
    ON DELETE CASCADE
    ON UPDATE CASCADE)
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8;


SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;

-- -----------------------------------------------------
-- Data for table `nyumba_yanga`.`city`
-- -----------------------------------------------------
START TRANSACTION;
USE `nyumba_yanga`;
INSERT INTO `nyumba_yanga`.`city` (`id`, `city`, `last_update`) VALUES (1, 'Lusaka', DEFAULT);

COMMIT;


-- -----------------------------------------------------
-- Data for table `nyumba_yanga`.`location`
-- -----------------------------------------------------
START TRANSACTION;
USE `nyumba_yanga`;
INSERT INTO `nyumba_yanga`.`location` (`id`, `city_id`, `location`, `description`, `last_update`) VALUES (1, 1, 'Kamwala South', DEFAULT, DEFAULT);
INSERT INTO `nyumba_yanga`.`location` (`id`, `city_id`, `location`, `description`, `last_update`) VALUES (2, 1, 'Ibex Hill', DEFAULT, DEFAULT);
INSERT INTO `nyumba_yanga`.`location` (`id`, `city_id`, `location`, `description`, `last_update`) VALUES (3, 1, 'Libala', DEFAULT, DEFAULT);
INSERT INTO `nyumba_yanga`.`location` (`id`, `city_id`, `location`, `description`, `last_update`) VALUES (4, 1, 'Kabulonga', DEFAULT, DEFAULT);
INSERT INTO `nyumba_yanga`.`location` (`id`, `city_id`, `location`, `description`, `last_update`) VALUES (5, 1, 'Roma', DEFAULT, DEFAULT);
INSERT INTO `nyumba_yanga`.`location` (`id`, `city_id`, `location`, `description`, `last_update`) VALUES (6, 1, 'Chalala', DEFAULT, DEFAULT);
INSERT INTO `nyumba_yanga`.`location` (`id`, `city_id`, `location`, `description`, `last_update`) VALUES (7, 1, 'Makeni', DEFAULT, DEFAULT);

COMMIT;


-- -----------------------------------------------------
-- Data for table `nyumba_yanga`.`property_feature`
-- -----------------------------------------------------
START TRANSACTION;
USE `nyumba_yanga`;
INSERT INTO `nyumba_yanga`.`property_feature` (`id`, `feature`, `type`, `last_update`) VALUES (1, 'Electric fence', 'outdoor', '2019-05-06 00:47:38');
INSERT INTO `nyumba_yanga`.`property_feature` (`id`, `feature`, `type`, `last_update`) VALUES (2, 'Geyser', 'indoor', '2019-05-06 00:47:38');
INSERT INTO `nyumba_yanga`.`property_feature` (`id`, `feature`, `type`, `last_update`) VALUES (3, 'Garden', 'outdoor', '2019-05-06 00:49:16');
INSERT INTO `nyumba_yanga`.`property_feature` (`id`, `feature`, `type`, `last_update`) VALUES (4, 'Bore hole', 'outdoor', '2019-05-06 00:49:16');
INSERT INTO `nyumba_yanga`.`property_feature` (`id`, `feature`, `type`, `last_update`) VALUES (5, 'Car port', 'outdoor', '2019-05-06 00:49:16');
INSERT INTO `nyumba_yanga`.`property_feature` (`id`, `feature`, `type`, `last_update`) VALUES (6, 'Modern fittings', 'indoor', '2019-05-06 00:49:16');
INSERT INTO `nyumba_yanga`.`property_feature` (`id`, `feature`, `type`, `last_update`) VALUES (7, 'Cable Available', 'indoor', '2019-05-06 00:50:19');
INSERT INTO `nyumba_yanga`.`property_feature` (`id`, `feature`, `type`, `last_update`) VALUES (8, 'Ceiling board', 'indoor', '2019-05-06 00:50:19');
INSERT INTO `nyumba_yanga`.`property_feature` (`id`, `feature`, `type`, `last_update`) VALUES (9, 'Fence', 'outdoor', '2019-05-06 00:51:32');
INSERT INTO `nyumba_yanga`.`property_feature` (`id`, `feature`, `type`, `last_update`) VALUES (10, 'Parking space', 'outdoor', '2019-05-06 00:51:32');
INSERT INTO `nyumba_yanga`.`property_feature` (`id`, `feature`, `type`, `last_update`) VALUES (11, 'Pool', 'outdoor', '2019-05-06 09:51:15');
INSERT INTO `nyumba_yanga`.`property_feature` (`id`, `feature`, `type`, `last_update`) VALUES (12, 'Lawn', 'outdoor', '2019-05-06 09:51:15');
INSERT INTO `nyumba_yanga`.`property_feature` (`id`, `feature`, `type`, `last_update`) VALUES (13, 'Air Conditioning', 'indoor', '2019-05-06 09:53:00');

COMMIT;

